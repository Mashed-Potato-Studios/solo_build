# Analyzer Component

The Analyzer component is responsible for analyzing code for complexity, dependencies, issues, and providing AI-powered architectural insights.

## Overview

The Analyzer processes the AST (Abstract Syntax Tree) generated by the Parser component and performs various analyses to provide insights about the code. It can detect issues, measure complexity, analyze dependencies, and provide architectural recommendations.

## API

### Constructor

```typescript
constructor(config: BuildConfig)
```

Creates a new Analyzer instance with the specified configuration.

#### Parameters

- `config`: The build configuration object

### Methods

#### analyze

```typescript
async analyze(ast: Record<string, any>): Promise<AnalysisResult>
```

Analyzes the AST and returns an analysis result.

##### Parameters

- `ast`: A record of file paths to their AST

##### Returns

A promise that resolves to an `AnalysisResult` object containing:
- `issues`: A record of file paths to arrays of issues
- `metrics`: A record of file paths to metric objects
- `score`: An overall architecture score (0-100)
- `insights`: An array of insights about the codebase
- `architecture`: An object containing architectural information

#### analyzeFile

```typescript
analyzeFile(filePath: string, ast: any): FileAnalysisResult
```

Analyzes a single file's AST.

##### Parameters

- `filePath`: The path to the file
- `ast`: The AST of the file

##### Returns

A `FileAnalysisResult` object containing:
- `issues`: An array of issues found in the file
- `metrics`: Metrics about the file

#### detectIssues

```typescript
detectIssues(filePath: string, ast: any): Issue[]
```

Detects issues in a file's AST.

##### Parameters

- `filePath`: The path to the file
- `ast`: The AST of the file

##### Returns

An array of `Issue` objects

#### calculateMetrics

```typescript
calculateMetrics(filePath: string, ast: any): Metrics
```

Calculates metrics for a file's AST.

##### Parameters

- `filePath`: The path to the file
- `ast`: The AST of the file

##### Returns

A `Metrics` object containing various metrics about the file

## Configuration Options

The Analyzer component uses the following configuration options:

- `analyze.complexity`: Whether to analyze code complexity
- `analyze.dependencies`: Whether to analyze dependencies
- `analyze.duplication`: Whether to analyze code duplication
- `analyze.security`: Whether to analyze security issues
- `ai.enabled`: Whether to enable AI-powered analysis
- `ai.analysisDepth`: The depth of AI analysis (basic, detailed, comprehensive)

## Example Usage

```typescript
import { Analyzer } from './analyzer';
import { BuildConfig } from '../types';
import { Parser } from '../packages/parser';

// Create a configuration
const config: BuildConfig = {
  // ... config options
  analyze: {
    complexity: true,
    dependencies: true,
    duplication: false,
    security: true
  },
  ai: {
    enabled: true,
    optimizationMode: 'suggestion',
    analysisDepth: 'detailed'
  }
};

// Parse files
const parser = new Parser(config);
const ast = await parser.parse(['src/index.ts', 'src/utils.ts']);

// Analyze code
const analyzer = new Analyzer(config);
const result = await analyzer.analyze(ast);

console.log(`Architecture score: ${result.score}/100`);
console.log(`Found ${Object.values(result.issues).flat().length} issues`);
```

## Implementation Details

The Analyzer uses various techniques to analyze code:

1. **Static Analysis**: Analyzes the structure of the code without executing it
2. **AST Traversal**: Walks through the AST to gather information
3. **Pattern Matching**: Identifies patterns that indicate issues or complexity
4. **Dependency Analysis**: Maps relationships between files and modules
5. **AI Integration**: Uses AI to provide architectural insights (when enabled)

## Issue Types

The Analyzer can detect various types of issues:

- **Syntax Issues**: Problems with the syntax of the code
- **Semantic Issues**: Problems with the meaning of the code
- **Style Issues**: Problems with the style of the code
- **Performance Issues**: Problems that may affect performance
- **Security Issues**: Problems that may introduce security vulnerabilities
- **Maintainability Issues**: Problems that may make the code harder to maintain

## Metrics

The Analyzer calculates various metrics for each file:

- **Complexity**: Cyclomatic complexity of functions
- **Dependencies**: Number of imports and exports
- **Size**: Lines of code, number of functions, classes, etc.
- **Nesting**: Maximum nesting level of control structures

## AI Integration

When AI is enabled, the Analyzer can provide additional insights:

- **Architectural Recommendations**: Suggestions for improving the architecture
- **Optimization Opportunities**: Opportunities for optimizing the code
- **Best Practices**: Recommendations for following best practices
- **Code Smells**: Identification of potential code smells

## Performance Considerations

- Analysis can be CPU-intensive for large codebases
- AI analysis requires additional processing time
- Duplication analysis can be particularly resource-intensive
- The Analyzer processes files in parallel for better performance

## Future Improvements

- Add support for more languages
- Improve AI integration with more advanced models
- Add support for custom analyzers
- Improve performance for large codebases
- Add support for incremental analysis
