# Transformer Component

The Transformer component is responsible for applying transformations to the AST (Abstract Syntax Tree) before code generation.

## Overview

The Transformer takes the AST generated by the Parser component and applies various transformations based on the build configuration. These transformations can include TypeScript type removal, module transformation, and custom user-defined transformations.

## API

### Constructor

```typescript
constructor(config: BuildConfig)
```

Creates a new Transformer instance with the specified configuration.

#### Parameters

- `config`: The build configuration object

### Methods

#### transform

```typescript
async transform(ast: Record<string, any>): Promise<Record<string, any>>
```

Transforms the AST according to the configuration.

##### Parameters

- `ast`: A record of file paths to their AST

##### Returns

A promise that resolves to a record of file paths to their transformed AST

#### applyTransformations

```typescript
async applyTransformations(ast: any): Promise<any>
```

Applies all configured transformations to an AST.

##### Parameters

- `ast`: The AST to transform

##### Returns

A promise that resolves to the transformed AST

#### loadTransformations

```typescript
async loadTransformations(): Promise<Transformation[]>
```

Loads all transformations specified in the configuration.

##### Returns

A promise that resolves to an array of Transformation objects

## Configuration Options

The Transformer component uses the following configuration options:

- `target`: The ECMAScript target version (e.g., 'es2020')
- `module`: The module format (e.g., 'commonjs', 'esm')
- `transformations`: An array of transformation names or objects

## Example Usage

```typescript
import { Transformer } from './transformer';
import { BuildConfig } from '../types';
import { Parser } from '../packages/parser';

// Create a configuration
const config: BuildConfig = {
  projectRoot: '/path/to/project',
  sourceDir: 'src',
  outDir: 'dist',
  target: 'es2020',
  module: 'commonjs',
  // ... other config options
  transformations: [
    'typescript',
    'modules',
    {
      name: 'custom-transform',
      options: {
        // Custom options
      }
    }
  ]
};

// Parse files
const parser = new Parser(config);
const ast = await parser.parse(['src/index.ts', 'src/utils.ts']);

// Transform AST
const transformer = new Transformer(config);
const transformedAst = await transformer.transform(ast);
```

## Built-in Transformations

The Transformer includes several built-in transformations:

### TypeScript

Removes TypeScript types from the AST, converting TypeScript to JavaScript.

### Modules

Transforms module formats (e.g., from ESM to CommonJS).

### Target

Transforms modern JavaScript features to be compatible with the target ECMAScript version.

### Minify

Removes comments, whitespace, and performs other optimizations to reduce code size.

## Custom Transformations

You can create custom transformations by implementing the `Transformation` interface:

```typescript
interface Transformation {
  name: string;
  apply(ast: any, context: TransformationContext): Promise<any> | any;
}
```

Example custom transformation:

```typescript
import { Transformation, TransformationContext } from '../types';

export class CustomTransformation implements Transformation {
  name = 'custom-transform';
  
  apply(ast: any, context: TransformationContext) {
    // Transform the AST
    return ast;
  }
}
```

## Implementation Details

The Transformer uses Babel's traversal and manipulation APIs to transform the AST. It handles the following tasks:

1. Loading and configuring transformations
2. Applying transformations in the correct order
3. Handling errors during transformation
4. Preserving source maps and other metadata

## Error Handling

The Transformer handles errors during the transformation process and provides detailed error messages. If a file fails to transform, the error is logged, but the transformation process continues for other files.

## Performance Considerations

- Transformation can be CPU-intensive for large files
- The Transformer processes files in parallel for better performance
- Some transformations may significantly increase memory usage

## Future Improvements

- Add support for more transformations
- Improve performance for large files
- Add support for incremental transformation
- Add support for transformation plugins
